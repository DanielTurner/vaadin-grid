<dom-module id="grid-filtering-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <h3>Filtering</h3>
    <p>
      <code>&lt;vaadin-grid-filter&gt;</code> can be used for filtering the grid data.
    </p>
    <p>
      You can alternatvely declare <code>&lt;vaadin-grid-simple-column&gt;</code> as <code>filterable</code>
      to enable filtering on that column.
    </p>
    <p>
      <b>NOTE: You must explicitly import the <code>vaadin-grid-filter</code> in order to use it.</b>
    </p>

    <vaadin-demo-snippet id='grid-filtering-demos-filtering'>
      <template preserve-content>
        <vaadin-grid aria-label="Filtering Example">
          <vaadin-grid-column id="firstname"></vaadin-grid-column>
          <vaadin-grid-simple-column filterable path="name.last" label="Last Name"></vaadin-grid-simple-column>
          <vaadin-grid-column id="email"></vaadin-grid-column>
        </vaadin-grid>

        <script>
          window.addDemoReadyListener('#grid-filtering-demos-filtering', function(document) {
            const grid = document.querySelector('vaadin-grid');
            grid.items = Vaadin.GridDemo.users;

            // First Name column configured manually (without a simple column helper)
            const firstNameColumn = document.querySelector('#firstname');
            firstNameColumn.headerRenderer = function(root) {
              root.innerHTML = '<vaadin-grid-filter path="name.first">First Name</vaadin-grid-filter>';
            };
            firstNameColumn.renderer = function(root, grid, model) {
              root.textContent = model.item.name.first;
            };

            // Email column filter is assigned a custom input field
            const emailColumn = document.querySelector('#email');
            emailColumn.headerRenderer = function(root) {
              root.innerHTML =
                '<vaadin-grid-filter path="email">' +
                '  <vaadin-text-field slot="filter" focus-target placeholder="Email">Email</vaadin-text-field>' +
                '</vaadin-grid-filter>';
              root.querySelector('vaadin-text-field').addEventListener('value-changed', function(e) {
                root.querySelector('vaadin-grid-filter').value = e.detail.value;
              });
            };
            emailColumn.renderer = function(root, grid, model) {
              root.textContent = model.item.email;
            };
          });
        </script>
      </template>
    </vaadin-demo-snippet>


    <h3>Filtering with Data Provider</h3>
    <p>
      While filtering works with array data providers out-of-the-box, custom data
      providers need to provide pre-filtered data to the vaadin-grid.
    </p>
    <p>
      Whenever the value of a vaadin-grid-filter changes, for example, when
      a user types something, the dataProvider is asked for fresh data with
      the <code>filters</code> included as one of the request parameters.
    </p>
    <p>
      <b>Hint: </b>When using a data provider, <code>path</code> on the filter element
      can be customized to be any string, instead of a property on the item object.
    </p>

    <vaadin-demo-snippet id='grid-filtering-demos-filtering-with-data-provider'>
      <template preserve-content>
        <vaadin-grid aria-label="Filtering with Data Provider Example">
          <vaadin-grid-simple-column filterable path="firstName"></vaadin-grid-simple-column>
          <vaadin-grid-simple-column filterable path="lastName"></vaadin-grid-simple-column>
          <vaadin-grid-simple-column path="email"></vaadin-grid-simple-column>
        </vaadin-grid>
        <script>
          window.addDemoReadyListener('#grid-filtering-demos-filtering-with-data-provider', function(document) {
            const grid = document.querySelector('vaadin-grid');

            grid.size = 200;
            grid.dataProvider = function(params, callback) {
              const xhr = new XMLHttpRequest();
              xhr.onload = function() {
                const response = JSON.parse(xhr.responseText);

                // Number of items changes after filtering. We need
                // to update the grid size based on server response.
                grid.size = response.size;

                callback(response.result);
              };

              const index = params.page * params.pageSize;
              let url = 'https://demo.vaadin.com/demo-data/1.0/people?index=' + index + '&count=' + params.pageSize;

              // `params.filters` format: [{path: 'lastName', direction: 'asc'}, ...];
              params.filters.forEach(function(filter) {
                url += '&filters[' + filter.path + ']=' + encodeURIComponent(filter.value);
              });

              xhr.open('GET', url, true);
              xhr.send();
            };
          });
        </script>
      </template>
    </vaadin-demo-snippet>


  </template>
  <script>
    class GridFilteringDemos extends DemoReadyEventEmitter(GridDemo(Polymer.Element)) {
      static get is() {
        return 'grid-filtering-demos';
      }
    }
    customElements.define(GridFilteringDemos.is, GridFilteringDemos);
  </script>
</dom-module>
